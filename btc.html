<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script
      type="text/javascript"
      src="https://www.gstatic.com/charts/loader.js"
    ></script>
  </head>
  <body>
    <div id="curve_chart" style="width: 900px; height: 500px"></div>
    <script>
      let socket = new WebSocket(
        "wss://stream.binance.com:9443/ws/btcusdt@trade"
      );

      let prices = [],
        times = [];
      (data = {}), (config = {});
      function getPricesArray() {
        return new Promise((resolve, reject) => {
          socket.onmessage = (evt) => {
            let time = new Date();
            time = time.toString().match(/(.\d\:){2}\d{2}/gm)[0];
            let seconds = time.split(":")[2]
            let data_ = evt.data;
            data_ = JSON.parse(data_);
            if (prices.length > 9) {
              prices.shift();
            }
            prices.push([time, parseInt(data_.p)]);
            resolve(prices);
          };
        });
      }
      setInterval(() => {
        google.charts.load("current", { packages: ["corechart"] });
        google.charts.setOnLoadCallback(drawChart);

        async function drawChart() {
          console.log(await getPricesArray());
          var data = google.visualization.arrayToDataTable([
            ["time", "Price"],
            ...await getPricesArray(),
          ]);

          var options = {
            title: "Company Performance",
            curveType: "function",
            legend: { position: "bottom" },
          };

          var chart = new google.visualization.LineChart(
            document.getElementById("curve_chart")
          );

          chart.draw(data, options);
        }
      }, 3000);
    </script>
  </body>
</html>
